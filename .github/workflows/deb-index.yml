name: Auto Generate Packages File
on:
  push:
    paths:
      - 'debs/**'  # 仅监听 debs 目录变动

jobs:
  generate-packages:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository with PAT
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT }}  # 显式使用 PAT 检出代码

      - name: Install dpkg-dev
        run: sudo apt-get update && sudo apt-get install -y dpkg-dev

      - name: Generate Packages files
        run: |
          # 生成压缩和未压缩的 Packages 文件
          dpkg-scanpackages debs/ /dev/null | gzip > Packages.gz
          dpkg-scanpackages debs/ /dev/null > Packages

      - name: Commit and push changes
        run: |
          # 添加并提交 Packages 文件
          git add Packages Packages.gz
          # 若没有修改，避免报错
          git commit -m "Auto-generate Packages file" || echo "No changes to commit"
          # 推送至主分支（根据你的仓库分支名调整）
          git push origin main
