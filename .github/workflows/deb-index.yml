name: Auto - Generate Repo Index
on:
  push:
    paths: ["repo/**/*.deb"]
jobs:
  build:
    runs - on: ubuntu - latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Install dpkg - scanpackages (依赖工具)
        run: |
          sudo apt - get update - y
          sudo apt - get install - y dpkg - dev  # 包含 dpkg - scanpackages 工具
      - name: Generate Packages.gz
        run: |
          mkdir - p repo
          dpkg - scanpackages repo/ /dev/null | gzip > repo/Packages.gz
          echo "索引文件已生成：$(ls - l repo/Packages.gz)"
      - name: Commit and push updates
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add repo/Packages.gz
          if git diff -- quiet; then
            echo "无索引变更，跳过提交。"
          else
            git commit - m "Auto - update repo index $(date +'%Y - %m - %d %H:%M:%S')"
            git push
          fi
